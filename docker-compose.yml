# Sample, used for development and testing purposes only.
services:
  gluetun:
    image: qmcgaw/gluetun:v3.41.0
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    environment:
      - VPN_SERVICE_PROVIDER=protonvpn
      - VPN_TYPE=wireguard
      - VPN_PORT_FORWARDING=on
      - WIREGUARD_PRIVATE_KEY=${WIREGUARD_PRIVATE_KEY}
      - SERVER_COUNTRIES=Netherlands
      - FIREWALL_DEBUG=on
      - FIREWALL_INPUT_PORTS=8080
      - FIREWALL_OUTBOUND_SUBNETS=172.20.0.0/16
      - HTTP_CONTROL_SERVER_ADDRESS=:8000
    ports:
      - 8000:8000  # Gluetun control server
      - 8080:8080  # qBittorrent WebUI (routed through gluetun)
    volumes:
      - ./gluetun/config.toml:/gluetun/auth/config.toml
    networks:
      - vpn_network

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
      - WEBUI_PORT=8080
    volumes:
      - ./qbittorrent/config:/config
      - ./downloads:/downloads
    network_mode: "service:gluetun"
    restart: unless-stopped
    depends_on:
      - gluetun

  port-sync:
    build: .
    container_name: port-sync
    environment:
      - GLUETUN_URL=http://gluetun:8000
      - GLUETUN_API_KEY=${GLUETUN_API_KEY}
      - GLUETUN_USERNAME=${GLUETUN_USERNAME}
      - GLUETUN_PASSWORD=${GLUETUN_PASSWORD}
      - QBITTORRENT_URL=http://gluetun:8080
      - QBITTORRENT_USERNAME=admin
      - QBITTORRENT_PASSWORD=${QBITTORRENT_PASSWORD}
    depends_on:
      - gluetun
      - qbittorrent
    restart: unless-stopped
    networks:
      - vpn_network

networks:
  vpn_network:
    driver: bridge
